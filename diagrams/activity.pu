@startuml
title Activity Diagram - Video Processing Service

|Client|
start
:Run CLI Client;
:Select video file;
:Choose processing option (e.g., compress, resize);
:Connect to Server;
:Construct MMP Packet (Header, JSON Options, Media Type, Payload);
:Send MMP Packet;

|Server|
:Receive MMP Packet;
:Parse Header;
:Check if IP is already processing;
if (IP is busy?) then (yes)
  :Send Error (Server Busy);
else (no)
  :Receive JSON, Media Type, Payload;
  :Check storage capacity;
  if (Enough space?) then (yes)
    :Save payload to temporary file;
    :Call VideoProcessor with options;
    :Process video with FFMPEG;
    if (Processing successful?) then (yes)
      :Construct MMP response with processed file;
      :Send processed file to Client;
    else (no)
      :Construct JSON error response;
      :Send error to Client;
    endif
    :Delete temporary and processed files;
  else (no)
    :Construct JSON error response (Storage Full);
    :Send error to Client;
  endif
  :Remove IP from active list;
endif

|Client|
:Receive response;
if (Response contains file?) then (yes)
  :Save processed file to disk;
  :Display success message;
else (no)
  :Parse JSON error;
  :Display detailed error message;
endif
:Close connection;

stop
@enduml
